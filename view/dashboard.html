<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Dashboard - Superviso</title>
    <!-- Font Awesome icons -->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css2?family=Catamaran:wght@300;600&family=Lato:wght@300;700&display=swap" rel="stylesheet" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- CSS -->
    <link rel="stylesheet" href="/css/styles.css">
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@2.0.3/dist/htmx.js"></script>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container px-5">
            <a class="navbar-brand" href="/dashboard">
                Superviso
                <img src="/assets/img/logo.png">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" 
                           href="#perfil" 
                           hx-get="/profile" 
                           hx-target="#main-content"
                           onclick="bootstrap.Collapse.getInstance(document.getElementById('navbarResponsive')).hide()">
                            <i class="fas fa-user"></i> Perfil
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" 
                           href="#supervisores" 
                           hx-get="/supervisors" 
                           hx-target="#main-content"
                           onclick="bootstrap.Collapse.getInstance(document.getElementById('navbarResponsive')).hide()">
                            <i class="fas fa-search"></i> Buscar Supervisores
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" 
                           href="#agendamentos" 
                           hx-get="/appointments" 
                           hx-target="#main-content"
                           onclick="bootstrap.Collapse.getInstance(document.getElementById('navbarResponsive')).hide()">
                            <i class="fas fa-calendar-alt"></i> Agendamentos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" 
                           href="#notificacoes" 
                           hx-get="/notifications" 
                           hx-target="#main-content"
                           onclick="bootstrap.Collapse.getInstance(document.getElementById('navbarResponsive')).hide()">
                            <i class="fas fa-bell"></i> Notificações
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-danger" 
                           href="#" 
                           hx-post="/users/logout"
                           hx-redirect="/">
                            <i class="fas fa-sign-out-alt"></i> Sair
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container py-5 mt-5">
        <div id="main-content">
            <!-- Dashboard Overview -->
            <div class="row">
                <!-- Card Informativo sobre Papel do Usuário -->
                <div id="roleWarning" class="col-12 mb-4">
                    <div class="card border-primary">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-info-circle text-primary fa-2x me-3"></i>
                                <div>
                                    <h5 class="card-title mb-2">Defina seu papel no sistema!</h5>
                                    <p class="card-text mb-2">
                                        Você ainda não definiu seu papel no sistema. Acesse seu perfil para escolher entre:
                                    </p>
                                    <ul class="mb-3">
                                        <li><strong>Supervisor:</strong> Profissional que oferece supervisão</li>
                                        <li><strong>Supervisionado:</strong> Profissional que busca supervisão</li>
                                    </ul>
                                    <p class="card-text mb-2"></p>
                                        Caso queira ser supervisionado, ignore esta mensagem.
                                    </p>
                                    <a href="#perfil" 
                                       class="btn btn-primary"
                                       hx-get="/profile" 
                                       hx-target="#main-content">
                                        <i class="fas fa-user-cog me-2"></i>Configurar Perfil
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card bg-primary text-white h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-uppercase">Próxima Supervisão</h6>
                                    <h4 class="mb-0">Em breve</h4>
                                </div>
                                <i class="fas fa-calendar fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card bg-success text-white h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-uppercase">Supervisões Realizadas</h6>
                                    <h4 class="mb-0">0</h4>
                                </div>
                                <i class="fas fa-check-circle fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card bg-info text-white h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-uppercase">Notificações</h6>
                                    <h4 class="mb-0">0</h4>
                                </div>
                                <i class="fas fa-bell fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card bg-warning text-white h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-uppercase">Supervisores Favoritos</h6>
                                    <h4 class="mb-0">0</h4>
                                </div>
                                <i class="fas fa-star fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Atividades Recentes</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted">Nenhuma atividade recente.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer 
    <footer class="py-4 bg-dark text-white text-center">
        <div class="container">
            <p class="mb-0">Copyright &copy; Superviso 2024. Todos os direitos reservados.</p>
        </div>
    </footer> -->

    <script>
    document.addEventListener('click', function(e) {
        const navbar = document.getElementById('navbarResponsive');
        const toggler = document.querySelector('.navbar-toggler');
        
        if (navbar.classList.contains('show') && 
            !navbar.contains(e.target) && 
            !toggler.contains(e.target)) {
            bootstrap.Collapse.getInstance(navbar).hide();
        }
    });
    </script>

    <script>
    // Função para verificar o papel do usuário via API
    function checkUserRole() {
        fetch('/api/profile/check-role')
            .then(response => response.json())
            .then(data => {
                const roleWarning = document.getElementById('roleWarning');
                if (roleWarning) {
                    roleWarning.style.display = data.hasRole ? 'none' : 'block';
                }
            });
    }

    // Verificar quando a página carrega
    document.addEventListener('DOMContentLoaded', checkUserRole);

    // Verificar quando o perfil é atualizado (evento HTMX)
    document.addEventListener('htmx:afterRequest', function(evt) {
        if (evt.detail.pathInfo.requestPath === '/api/profile/update') {
            checkUserRole();
        }
    });
    </script>
</body>
</html> 